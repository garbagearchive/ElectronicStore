    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>User Management</title>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <link rel="stylesheet" href="styles.css">
        <style>
            /* Modal styles */
            .modal {
                display: none;
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background-color: white;
                padding: 40px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
                z-index: 1000;
                width: 300px;
                border-radius: 8px;
            }

            .modal-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.5);
                z-index: 999;
            }

            .modal.open {
                display: block;
            }

            .modal-overlay.open {
                display: block;
            }

            .modal h2 {
                margin-top: 0;
            }

            .modal form label {
                display: block;
                margin-bottom: 5px;
            }

            .modal form input {
                width: 100%;
                padding: 8px;
                margin-bottom: 10px;
                border: 1px solid #ccc;
                border-radius: 4px;
            }

            .modal form button {
                padding: 8px 12px;
                margin-right: 10px;
                border: none;
                border-radius: 4px;
                cursor: pointer;
            }

                .modal form button[type="submit"] {
                    background-color: #28a745;
                    color: white;
                }

                .modal form button[type="button"] {
                    background-color: #dc3545;
                    color: white;
                }

            /* Sort dropdown styles */
            .sort-dropdown {
                position: relative;
                display: inline-block;
            }

            .sort-dropdown-content {
                display: none;
                position: absolute;
                background-color: #f9f9f9;
                min-width: 160px;
                box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
                z-index: 1;
                right: 0;
            }

                .sort-dropdown-content a {
                    color: black;
                    padding: 12px 16px;
                    text-decoration: none;
                    display: block;
                    cursor: pointer;
                }

                    .sort-dropdown-content a:hover {
                        background-color: #f1f1f1;
                    }

            .sort-dropdown:hover .sort-dropdown-content {
                display: block;
            }

            .sort-btn {
                background: none;
                border: none;
                cursor: pointer;
                padding: 0;
                font-weight: bold;
            }
        </style>
    </head>
    <body>
        <!-- Sidebar -->
        <div class="sidebar">
            <h2 style="color: white; text-align: center;">Navigation</h2>
            <a href="/user-manager.html">User Manager</a>
            <a href="/product-manager.html">Product Manager</a>
            <a href="/product-discount-manager.html">Product discount Manager</a>
            <a href="/order-manager.html">Order Manager</a>
            <a href="/order-detail-manager.html">Order Detail Manager</a>
            <a href="/cart-manager.html">Cart Manager</a>
            <a href="/payment-manager.html">Payment Manager</a>
            <a href="/shipping-manager.html">Shipping Manager</a>
            <a href="/discount-manager.html">Discount Manager</a>
            <a href="/repair-manager.html">Repair Manager</a>
            <a href="/review-manager.html">Review Manager</a>
        </div>
        <div class="main-content">
            <h1>User Management</h1>

            <!-- Search Form -->
            <form id="searchForm">
                <input type="text" id="searchKeyword" placeholder="Search by name">
                <button type="submit">Search</button>
            </form>

            <!-- User List -->
            <table id="userTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>
                            Username
                            <div class="sort-dropdown">
                                <button class="sort-btn" onclick="toggleDropdown('username')">▼</button>
                                <div id="username-dropdown" class="sort-dropdown-content">
                                    <a onclick="sortTable('username', 'asc')">A → Z</a>
                                    <a onclick="sortTable('username', 'desc')">Z → A</a>
                                </div>
                            </div>
                        </th>
                        <th>
                            Full Name
                            <div class="sort-dropdown">
                                <button class="sort-btn" onclick="toggleDropdown('fullName')">▼</button>
                                <div id="fullName-dropdown" class="sort-dropdown-content">
                                    <a onclick="sortTable('fullName', 'asc')">A → Z</a>
                                    <a onclick="sortTable('fullName', 'desc')">Z → A</a>
                                </div>
                            </div>
                        </th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Address</th>
                        <th>
                            Role
                            <div class="sort-dropdown">
                                <button class="sort-btn" onclick="toggleDropdown('role')">▼</button>
                                <div id="role-dropdown" class="sort-dropdown-content">
                                    <a onclick="sortTable('role', 'admin')">Admin</a>
                                    <a onclick="sortTable('role', 'buyer')">Buyer</a>
                                </div>
                            </div>
                        </th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- User rows will be populated here -->
                </tbody>
            </table>
        </div>

        <!-- Modal for Edit Form -->
        <div class="modal-overlay" id="modalOverlay"></div>
        <div class="modal" id="editModal">
            <h2>Edit User</h2>
            <form id="userForm">
                <input type="hidden" id="userId">
                <label for="username">Username:</label>
                <input type="text" id="username" placeholder="Username" required><br>
                <label for="passwordHash">Password Hash:</label>
                <input type="text" id="passwordHash" placeholder="Password Hash" required><br>
                <label for="fullName">Full Name:</label>
                <input type="text" id="fullName" placeholder="Full Name" required><br>
                <label for="email">Email:</label>
                <input type="email" id="email" placeholder="Email" required><br>
                <label for="phone">Phone:</label>
                <input type="text" id="phone" placeholder="Phone" required><br>
                <label for="address">Address:</label>
                <input type="text" id="address" placeholder="Address" required><br>
                <label for="role">Role:</label>
                <input type="text" id="role" placeholder="Role (default: Buyer)"><br>
                <button type="submit" id="saveButton">Update User</button>
                <button type="button" id="cancelButton">Cancel</button>
            </form>
        </div>

        <script>
            $(document).ready(function () {
                loadUsers();

                // Load all users
                function loadUsers() {
                    $.get('/api/user/List', function (data) {
                        $('#userTable tbody').empty();
                        data.data.forEach(function (user) {
                            $('#userTable tbody').append(`
                                            <tr>
                                                <td>${user.userId}</td>
                                                <td>${user.username}</td>
                                                <td>${user.fullName}</td>
                                                <td>${user.email}</td>
                                                <td>${user.phone}</td>
                                                <td>${user.address}</td>
                                                <td>${user.role}</td>
                                                <td>
                                                    <button onclick="editUser(${user.userId})">Edit</button>
                                                    <button onclick="deleteUser(${user.userId})">Delete</button>
                                                </td>
                                            </tr>
                                        `);
                        });
                    });
                }

                // Search users by name
                $('#searchForm').submit(function (event) {
                    event.preventDefault();
                    var keyword = $('#searchKeyword').val();
                    $.get('/api/user/Search', { keyword: keyword }, function (data) {
                        $('#userTable tbody').empty();
                        data.data.forEach(function (user) {
                            $('#userTable tbody').append(`
                                            <tr>
                                                <td>${user.userId}</td>
                                                <td>${user.username}</td>
                                                <td>${user.fullName}</td>
                                                <td>${user.email}</td>
                                                <td>${user.phone}</td>
                                                <td>${user.address}</td>
                                                <td>${user.role}</td>
                                                <td>
                                                    <button onclick="editUser(${user.userId})">Edit</button>
                                                    <button onclick="deleteUser(${user.userId})">Delete</button>
                                                </td>
                                            </tr>
                                        `);
                        });
                    });
                });

                // Edit User
                window.editUser = function (userId) {
                    $.get(`/api/user/Get/${userId}`, function (data) {
                        var user = data.data; // Access the user object from the response
                        if (user) {
                            $('#userId').val(user.userId);
                            $('#username').val(user.username);
                            $('#passwordHash').val(user.passwordHash);
                            $('#fullName').val(user.fullName);
                            $('#email').val(user.email);
                            $('#phone').val(user.phone);
                            $('#address').val(user.address);
                            $('#role').val(user.role);
                            openModal();
                        }
                    }).fail(function () {
                        alert('Failed to fetch user details.');
                    });
                };

                // Open Modal
                function openModal() {
                    $('#editModal, #modalOverlay').addClass('open');
                }

                // Close Modal
                function closeModal() {
                    $('#editModal, #modalOverlay').removeClass('open');
                    resetForm();
                }

                // Update User
                $('#userForm').submit(function (event) {
                    event.preventDefault();
                    var user = {
                        userId: $('#userId').val(),
                        username: $('#username').val(),
                        passwordHash: $('#passwordHash').val(),
                        fullName: $('#fullName').val(),
                        email: $('#email').val(),
                        phone: $('#phone').val(),
                        address: $('#address').val(),
                        role: $('#role').val() || 'Buyer'
                    };

                    $.ajax({
                        url: `/api/user/Update/${user.userId}`,
                        type: 'PUT',
                        contentType: 'application/json',
                        data: JSON.stringify(user),
                        success: function () {
                            loadUsers();
                            closeModal();
                        }
                    });
                });

                // Cancel Edit
                $('#cancelButton').click(function () {
                    closeModal();
                });

                // Reset Form
                function resetForm() {
                    $('#userId').val('');
                    $('#username').val('');
                    $('#passwordHash').val('');
                    $('#fullName').val('');
                    $('#email').val('');
                    $('#phone').val('');
                    $('#address').val('');
                    $('#role').val('');
                }

                // Delete User
                window.deleteUser = function (userId) {
                    if (confirm('Are you sure you want to delete this user?')) {
                        $.ajax({
                            url: `/api/user/Delete/${userId}`,
                            type: 'DELETE',
                            success: function () {
                                loadUsers();
                            }
                        });
                    }
                };
            });

            function toggleDropdown(column) {
                // Close all other dropdowns
                document.querySelectorAll('.sort-dropdown-content').forEach(dropdown => {
                    if (dropdown.id !== `${column}-dropdown`) {
                        dropdown.style.display = 'none';
                    }
                });

                // Toggle the current dropdown
                const dropdown = document.getElementById(`${column}-dropdown`);
                dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
            }

            function sortTable(column, direction) {
                let rows = $('#userTable tbody tr').get();

                rows.sort(function (a, b) {
                    let valA, valB;

                    if (column === 'role') {
                        // Special sorting for role
                        valA = $(a).find('td:nth-child(7)').text().toLowerCase();
                        valB = $(b).find('td:nth-child(7)').text().toLowerCase();

                        if (direction === 'admin') {
                            // Admin first
                            if (valA === 'admin' && valB !== 'admin') return -1;
                            if (valA !== 'admin' && valB === 'admin') return 1;
                        } else {
                            // Buyer first
                            if (valA === 'admin' && valB !== 'admin') return 1;
                            if (valA !== 'admin' && valB === 'admin') return -1;
                        }
                        return 0;
                    } else {
                        // Normal alphabetical sorting for username and fullName
                        valA = $(a).find(`td:nth-child(${getColumnIndex(column)})`).text().toLowerCase();
                        valB = $(b).find(`td:nth-child(${getColumnIndex(column)})`).text().toLowerCase();

                        if (direction === 'asc') {
                            return valA.localeCompare(valB);
                        } else {
                            return valB.localeCompare(valA);
                        }
                    }
                });

                $('#userTable tbody').empty().append(rows);

                // Close the dropdown after selection
                document.getElementById(`${column}-dropdown`).style.display = 'none';
            }

            function getColumnIndex(column) {
                switch (column) {
                    case 'username': return 2;
                    case 'fullName': return 3;
                    case 'role': return 7;
                    default: return 2;
                }
            }

            // Close dropdowns when clicking elsewhere
            window.onclick = function (event) {
                if (!event.target.matches('.sort-btn') && !event.target.matches('.sort-dropdown-content a')) {
                    document.querySelectorAll('.sort-dropdown-content').forEach(dropdown => {
                        dropdown.style.display = 'none';
                    });
                }
            }
        </script>
    </body>
    </html>